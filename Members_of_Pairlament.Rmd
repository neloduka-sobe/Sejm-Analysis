---
title: "Analysis of Members of Polish Parliament"
subtitle: "Based on data from api.sejm.gov.pl"
author: "Borys Łangowicz (neloduka_sobe)"
format:
  html:
    code-tools: true
    code-fold: true
number-sections: true
editor: visual
include-after-body: "footer.html"
---

# Loading the Data

```{R, message=FALSE}
# Libraries
library(knitr)
library(dplyr, warn.conflicts = FALSE)
options(dplyr.summarise.inform = FALSE)
library(ggplot2)
library(treemapify)
library(DT)
library(lubridate, warn.conflicts = FALSE)
library(calendR)

# Data
mp_path <- "./Data/mp.csv"
clubs_path <- "./Data/clubs.csv"
mp <- read.csv(mp_path)
clubs <- read.csv(clubs_path)
```

# Background of the data

This data has been downloaded from [API of Polish Parliament](https://api.sejm.gov.pl/), to analyze the general statistics considering Polish MPs, and to give an insights on political processes of the Polish political body.

# Description of the Data

## Members of Parliament

```{R}
datatable(mp, filter = "top")
```

**`active`**: Determines if MP is an active MP

**`birthDate`**: Date of birth

**`birthLocation`**: Location of birth

**`club`**: Club membership

**`districtName`**: Name of the district of the MP

**`districtNum`**: Number of the district of the MP

**`educationLevel`**: Education level of the MP

**`email`**: E-mail to the MP

**`firstLastName`**: First and last name of the MP

**`firstName`**: First name of the MP

**`id`**: Id of the MP

**`lastFirstName`**: Last and first name of the MP

**`lastName`**: Last name of the MP

**`numberOfVotes`**: Number of votes for the MP

**`profession`**: Profession of the MP

**`secondName`**: Second name

**`voivodeship`**: Voivodeship of the MP

**`inactiveCause`**: The cause why MP is inactive (if inactive)

**`waiverDesc`**: Description of the cause why MP is inactive (if inactive)

## Clubs

```{R}
kable(clubs)
```

**`email`**: E-mail of the club

**`fax`**: Fax of the club

**`id`**: Id of the club

**`membersCount`**: Number of members

**`name`**: Name of the club

**`phone`**: Phone number of the club

# Cleaning the Data

We would drop phone, email, and fax of the club, as it is data, we don't need for the statistical analysis

```{R}
clubs <- clubs %>%
  select(id, membersCount, name)
```

We would also drop `firstLastName`, and `lastFirstName`, as those are redundant in respect to `firstName`, `secondName`, and `lastName`

```{R}
mp <- mp %>%
  select(!c(firstLastName, lastFirstName))
```

We also change `birthDate` to the date type

```{R}
mp <- mp %>%
  mutate(birthDate = as_date(birthDate))
```

# Translating the data

#TODO

# What is the club distribution in the parliament?

```{R}
club_distribution <- mp %>% group_by(club) %>%
  summarise(number_of_members = n()) %>%
  arrange(desc(number_of_members))
kable(club_distribution)
```

As we can see from the table the biggest club in the parliament right now is PiS with 192 MPs.

# What is the distribution of the MPs per voivodeships?

```{R}
voivodeship_distribution <- mp %>%
  group_by(voivodeship, club) %>%
  summarise(number_of_members = n()) %>%
  arrange(voivodeship, desc(number_of_members))

per_voivodeship <- voivodeship_distribution %>%
  group_by(voivodeship) %>%
  summarise(number_of_members = sum(number_of_members))

ggplot(per_voivodeship, aes(x="", y=number_of_members, fill=voivodeship)) + geom_bar(stat="identity") + coord_polar("y")
```

# What is the distribution of the MPs per voivodeship with regard to the club?

```{R}
ggplot(voivodeship_distribution, aes(fill=club, y=number_of_members, x=club)) +
  geom_bar(position="dodge", stat="identity") +
  scale_x_discrete(labels = NULL, breaks = NULL) +
  labs(x = NULL) +
  facet_wrap(~voivodeship)
```

# How does the distribution of education level of the Polish MPs look like?

```{R}
ggplot(mp, aes(x=educationLevel)) +
  geom_bar()
```

# How does the distribution of professions of the Polish MPs look like?

```{R}
professions <- mp %>%
  group_by(profession) %>%
  summarize(number = n()) %>%
  filter(!is.na(profession)) %>%
  arrange(desc(number))
datatable(professions, filter = "top")

p <- professions %>% filter(number > 1)
ggplot(p, aes(x=profession, y=number)) +
  geom_segment(aes(x=profession, xend=profession, y=0, yend=number)) +
  theme(axis.text.x = element_text(size = 8, angle = 45, hjust = 1))
```

# Are there any inactive MP? What are the causes of it?

```{R}
not_active <- mp %>% filter(!active) %>%
  select(firstName, secondName, lastName, club, inactiveCause, waiverDesc)
kable(not_active)
```

# Visualization of number of votes per MP using treemap

```{R, out.width="100%"}
treemap <- mp %>% mutate(secondName = ifelse(is.na(secondName), "", secondName))
ggplot(treemap, aes(area=numberOfVotes, fill=club, 
               label=paste(firstName, secondName, lastName), subgroup=club)) + 
  geom_treemap() +
  geom_treemap_subgroup_border() +
  geom_treemap_text(min.size=1) +
  theme_void()
```

## What is the distribution of number of votes per club?

```{R}
ggplot(mp, aes(x=club, y=numberOfVotes, fill=club)) +
  geom_boxplot() +
  theme_classic() +
  theme(legend.position="none")
```

# Visualization using map for districts of MPs

```{R}
# Use API to get coordinates
# Mutate dataset
# Use ggplot for plotting the data
# TODO
```

# Visualisation using calendar for birthdays

```{R, out.width="100%"}
# https://r-charts.com/evolution/calendar-heatmap/
birthdays_per_day <- mp %>%
  group_by(month = month(birthDate), day = day(birthDate)) %>%
  summarise(number=n())

birthdays_per_day <- birthdays_per_day %>% mutate(date = as.Date(paste("2024", month, day, sep="-"))) %>% mutate(yday = yday(date))

all_days_df <- data.frame(yday = 1:366)
merged_df <- merge(all_days_df, birthdays_per_day, by = "yday", all.x = TRUE)
merged_df$number[is.na(merged_df$number)] <- 0

calendR(year = 2024,
        special.days = merged_df$number,
        gradient = TRUE,
        low.col = "#FCFFDD",
        special.col = "#00AAAE",
        legend.pos = "bottom",
        day.size=3.5,
        title.size = 0,
        weeknames.size=2)
```

------------------------------------------------------------------------

# Introducing Voting Data

The Polish Parliament API provides the data on all the voting, including the votes of a single MP. It provides a great opportunity to statistically analyze, and visualize the processes behind most important decisions in Poland.

# Loading the Data

on_list_voting_files

```{R}
# Move data cleaning to download_data.R

# Two votings types: Yes/No; on list
votings_path <- "./Data/votings/"

# Yes/No votings
y_n_votings <- read.csv(paste0(votings_path, "y_n_votings.csv"))

# On List votings #TODO
on_list_voting_files <- list.files(votings_path, pattern = "sitting")

for (i in on_list_voting_files) {
  temp <- read.csv(paste0(votings_path, i))
  rm(temp)
}
```

# Cleaning the data

We are dropping yes column, as it contains number of yes votes, votes.firstName, votes.lastName, votes.secondName, votes.club, term as those data is redundant.

```{R}
# Yes/No votings
head(y_n_votings)
```

# Description of the Data

```{R}

```
